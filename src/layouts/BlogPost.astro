---
import Layout from "./Layout.astro";
import type { CollectionEntry } from "astro:content";
import ShareButtons from "../components/ShareButtons.astro";

type Props = CollectionEntry<"blog">["data"] & {
  slug: string;
  readingTime?: string;
};

const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags,
  slug,
  readingTime,
} = Astro.props;

const currentUrl = Astro.url.toString();

// OGP画像URLの生成
const ogImage = heroImage || `/ogp/${slug}.png`;
---

<Layout
  title={title}
  description={description}
  ogImage={ogImage}
  ogType="article"
  pubDate={pubDate}
  modifiedDate={updatedDate}
  tags={tags}
>
  <article class="container-narrow py-8">
    {
      heroImage && (
        <img
          width={1020}
          height={510}
          src={heroImage}
          alt=""
          class="border-dark shadow-card mb-8 rounded-xs border"
        />
      )
    }
    <div class="mb-8 text-center">
      <h1 class="text-title mb-4" transition:name={`title-${slug}`}>{title}</h1>
      <div class="flex flex-wrap items-center justify-center gap-4">
        <div class="text-label">
          <div class="i-lucide:calendar"></div>
          <time datetime={pubDate.toISOString()}>
            {pubDate.toLocaleDateString("ja-JP")}
          </time>
        </div>
        {
          updatedDate && (
            <div class="text-label">
              <div class="i-lucide:refresh-cw" />
              <span>Updated:</span>
              <time datetime={updatedDate.toISOString()}>
                {updatedDate.toLocaleDateString("ja-JP")}
              </time>
            </div>
          )
        }
        {
          readingTime && (
            <div class="text-label">
              <div class="i-lucide:clock" />
              <span>{readingTime}</span>
            </div>
          )
        }
      </div>
      {
        tags && tags.length > 0 && (
          <div class="mt-6 flex flex-wrap justify-center gap-2">
            {tags.map((tag) => (
              <a
                href={`/tags/${tag.toLowerCase()}`}
                class="tag tag-hover"
                transition:name={`tags-${tag}`}
              >
                <div class="i-lucide:tag text-light" />
                {tag}
              </a>
            ))}
          </div>
        )
      }
    </div>
    <div class="prose prose-lg prose-neutral dark:prose-invert mx-auto">
      <slot />
    </div>

    {/* 記事フッター - シェアボタン */}
    <div class="border-base mt-12 flex justify-end border-t pt-8">
      <ShareButtons url={currentUrl} title={title} />
    </div>
  </article>
</Layout>

{/* JavaScriptスクリプトの読み込み */}
<script>
  import "../scripts/codeCopy";
  import "../scripts/anchorLinks";
</script>

<style is:global>
  .rlc-container {
    display: flex;
    flex-direction: column-reverse;
    text-decoration: none !important;
    --at-apply: "card p-3";
  }

  .rlc-title {
    --at-apply: "text-subhead mb-1 line-clamp-1";
  }

  .rlc-description {
    --at-apply: "text-body-sm line-clamp-3 text-light";
  }

  .rlc-url-container {
    --at-apply: "text-caption flex items-center gap-1";
  }

  img.rlc-favicon {
    margin: 0;
  }

  img.rlc-image {
    margin: 0;
  }
</style>
