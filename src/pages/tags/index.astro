---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const posts = await getCollection("blog");

const tagCounts = posts.reduce(
  (acc, post) => {
    post.data.tags.forEach((tag) => {
      const normalizedTag = tag.toLowerCase();
      acc[normalizedTag] = (acc[normalizedTag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>,
);

const sortedTags = Object.entries(tagCounts).sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});
---

<Layout title="Tags | Blog | HALQME">
  <section class="section">
    <div class="mb-8 flex items-start justify-between">
         <h1 class="text-headline mb-0 flex items-center gap-3">
           <div class="i-lucide:tags"></div>
           Tags
         </h1>
         <a href="/blog" class="btn-ghost text-sm">
           <div class="i-lucide:pen-tool"></div>
           Blog
         </a>
       </div>

    {
      sortedTags.length === 0 ? (
        <p class="text-body">タグがありません。</p>
      ) : (
        <div class="flex flex-wrap gap-3">
          {sortedTags.map(([tag, count]) => (
            <a href={`/tags/${tag.toLowerCase()}`} class="tag tag-hover group">
              <div class="i-lucide:tag text-gray-400 transition-colors group-hover:text-black" />
              <span class="text-gray-700">{tag}</span>
              <span class="ml-1 border-l border-gray-200 pl-1.5 text-xs text-gray-400">
                {count}
              </span>
            </a>
          ))}
        </div>
      )
    }
  </section>
</Layout>
