---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const posts = await getCollection("blog");

const tagCounts = posts.reduce(
  (acc, post) => {
    post.data.tags.forEach((tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>,
);

const sortedTags = Object.entries(tagCounts).sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});
---

<Layout title="Tags | Blog | HALQME">
  <section>
    <h1 class="heading-2 mb-8">
      <div class="i-lucide:tags mr-2"></div>
      Tags
    </h1>

    {
      sortedTags.length === 0 ? (
        <p class="text-sub text-gray-500">タグがありません。</p>
      ) : (
        <div class="flex flex-wrap gap-3">
          {sortedTags.map(([tag, count]) => (
            <a href={`/tags/${tag}`} class="tag-base tag-hover group bg-white">
              <div class="i-lucide:tag text-gray-400 transition-colors group-hover:text-black" />
              <span class="text-gray-700">{tag}</span>
              <span class="text-meta ml-1 border-l border-gray-200 pl-1.5 text-xs text-gray-400">
                {count}
              </span>
            </a>
          ))}
        </div>
      )
    }
  </section>
</Layout>
